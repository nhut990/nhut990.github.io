<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Game √ù Nh·∫£y Tr√°nh Ch∆∞·ªõng Ng·∫°i V·∫≠t</title>
<style>
  :root{
    --bg:#f7f7f7;
    --ground:#555;
    --accent:#ff6b6b;
  }
  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    font-family:system-ui,Arial;
    overflow:hidden;
  }
  h1{
    font-size:18px;
    margin:8px 0 4px;
    color:#222;
    font-weight:700;
    text-align:center;
    padding:0 10px;
    line-height:1.2;
  }
  .game-wrap{
    width:900px;
    max-width:96vw;
    height:320px;
    background:linear-gradient(#e9f0ff,#f7f7f7 60%);
    border:1px solid #ddd;
    box-shadow:0 8px 30px rgba(0,0,0,0.08);
    position:relative;
    overflow:hidden;
    border-radius:8px;
    touch-action:none;
  }
  canvas{
    display:block;
    width:100%;
    height:100%;
  }
  .score{
    position:absolute;
    right:12px;
    top:10px;
    color:#222;
    font-weight:700;
  }
  .overlay{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
  }
  .msg{
    pointer-events:auto;
    background:rgba(255,255,255,0.95);
    border-radius:8px;
    padding:16px 22px;
    text-align:center;
    box-shadow:0 6px 18px rgba(0,0,0,0.12);
  }
  .btn{
    margin-top:10px;
    display:inline-block;
    padding:8px 14px;
    border-radius:6px;
    background:var(--accent);
    color:white;
    font-weight:700;
    cursor:pointer;
    text-decoration:none;
  }
  .hint{
    position:absolute;
    left:10px;
    bottom:4px;
    font-size:11px;
    color:#555;
    opacity:0.9;
    background:rgba(255,255,255,0.6);
    padding:2px 6px;
    border-radius:4px;
  }

  @media (orientation: landscape) {
    .game-wrap{ height:240px; }
    h1{ font-size:15px; }
    .hint{ font-size:9px; bottom:2px; left:8px; padding:1px 5px; }
  }
</style>
</head>
<body>
  <h1>Game √ù Nh·∫£y Tr√°nh Ch∆∞·ªõng Ng·∫°i V·∫≠t</h1>
  <div class="game-wrap" id="game">
    <canvas id="c"></canvas>
    <div class="score" id="score">0</div>
    <div class="hint">Nh·∫•n Space / M≈©i l√™n ho·∫∑c ch·∫°m ƒë·ªÉ nh·∫£y</div>
    <div class="overlay" id="overlay" style="display:none">
      <div class="msg" id="msg">
        <div id="msgText" style="font-size:18px;font-weight:800;color:#222">√ù Thua R·ªìi!</div>
        <div style="margin-top:8px;color:#444" id="msgSub">Nh·∫•n CH∆†I L·∫†I ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
        <a class="btn" id="restart">CH∆†I L·∫†I</a>
      </div>
    </div>
  </div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

function fitCanvas(){
  const r = canvas.getBoundingClientRect();
  const scale = window.devicePixelRatio || 1;
  canvas.width = r.width * scale;
  canvas.height = r.height * scale;
  ctx.setTransform(scale, 0, 0, scale, 0, 0);
}
ctx.imageSmoothingEnabled = false;
fitCanvas();
addEventListener('resize', fitCanvas);

const W = ()=>canvas.width / (window.devicePixelRatio || 1);
const H = ()=>canvas.height / (window.devicePixelRatio || 1);

let groundY, lastTime=0, run=false;
let scoreEl = document.getElementById('score');
let overlay = document.getElementById('overlay');
let msgText = document.getElementById('msgText');
let msgSub = document.getElementById('msgSub');

// √Çm thanh (d√πng file b·∫°n g·ª≠i)
const sndJump = new Audio("https://github.com/nhut990/files/raw/refs/heads/main/music/mario_nhay.mp3");
const sndLose = new Audio("https://github.com/nhut990/files/raw/refs/heads/main/music/Mario_Game%20over.mp3");
let soundReady = false;

function enableSoundOnce() {
  if (soundReady) return;
  soundReady = true;
  // ‚ÄúKh·ªüi ƒë·ªông‚Äù nh·∫π ƒë·ªÉ browser cho ph√©p ph√°t
  sndJump.play().then(()=>sndJump.pause());
  sndLose.play().then(()=>sndLose.pause());
}
["click","keydown","touchstart","pointerdown"].forEach(e=>{
  document.body.addEventListener(e, enableSoundOnce);
});

const state = {
  speed:6, gravity:0.6, obstacles:[],
  spawnTimer:0, spawnInterval:1000,
  score:0, difficultyTimer:0
};

const dino = {x:60, w:70, h:70, y:0, vy:0, onGround:true};

// ·∫¢nh nh√¢n v·∫≠t
let dinoImg = new Image();
dinoImg.src = "https://raw.githubusercontent.com/nhut990/files/refs/heads/main/hinh/logo%20y.png";

function renderDino(){
  if(dinoImg.complete){
    ctx.drawImage(dinoImg, dino.x, dino.y, dino.w, dino.h);
  } else {
    ctx.fillStyle='#2b2b2b';
    ctx.fillRect(dino.x, dino.y, dino.w, dino.h);
  }
}

function randInt(a,b){ return Math.floor(Math.random()*(b-a+1)) + a; }

function createObstacle(){
  const t = Math.random() < 0.25 ? 'tall' : 'short';
  let w = t === 'tall' ? randInt(32,48) : randInt(22,36);
  let h = t === 'tall' ? randInt(48,78) : randInt(24,40);
  return {x: W()+10, w, h, passed: false, color: '#333'};
}

function jump(){
  if(!run){
    startGame();
    return;
  }
  if(dino.onGround){
    dino.vy = -12;
    dino.onGround = false;
    if(soundReady){
      sndJump.currentTime = 0;
      sndJump.play();
    }
  }
}

addEventListener('keydown', e=>{
  if(e.code === 'Space' || e.code === 'ArrowUp'){
    e.preventDefault();
    jump();
  }
});
canvas.addEventListener('touchstart', e=>{
  e.preventDefault();
  jump();
},{passive:false});
canvas.addEventListener('mousedown', ()=>jump());

function startGame(){
  state.obstacles = [];
  state.speed = 6;
  state.spawnTimer = 0;
  state.spawnInterval = 1000;
  state.score = 0;
  state.difficultyTimer = 0;
  dino.y = 0;
  dino.vy = 0;
  dino.onGround = true;
  overlay.style.display = 'none';
  run = true;
  lastTime = performance.now();
  requestAnimationFrame(loop);
}
document.getElementById('restart').addEventListener('click', startGame);

function collides(a,b){
  return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h);
}

function gameOver(){
  run = false;
  if(soundReady){
    sndLose.currentTime = 0;
    sndLose.play();
  }
  overlay.style.display = 'flex';
  msgText.textContent = '√ù THUA R·ªíI üòÇ';
  msgSub.textContent = 'ƒêi·ªÉm: ' + Math.floor(state.score);
}

function render(){
  ctx.clearRect(0,0,W(),H());
  ctx.fillStyle = '#cfcfcf';
  ctx.fillRect(0, groundY, W(), H() - groundY);
  renderDino();
  for(const ob of state.obstacles){
    ctx.fillStyle = ob.color;
    const oy = groundY - ob.h;
    ctx.fillRect(ob.x, oy, ob.w, ob.h);
  }
}

function loop(now){
  if(!run) return;
  const dt = Math.min(40, now - lastTime);
  lastTime = now;

  groundY = Math.floor(H() * 0.86);

  if(dino.y === 0 && dino.onGround) dino.y = groundY - dino.h;
  dino.vy += state.gravity;
  dino.y += dino.vy;
  if(dino.y + dino.h >= groundY){
    dino.y = groundY - dino.h;
    dino.vy = 0;
    dino.onGround = true;
  }

  state.spawnTimer += dt;
  if(state.spawnTimer >= state.spawnInterval){
    state.spawnTimer = 0;
    state.obstacles.push(createObstacle());
    state.spawnInterval = randInt(700,1400) - Math.floor(state.speed * 20);
  }

  for(let i = state.obstacles.length - 1; i >= 0; i--){
    const ob = state.obstacles[i];
    ob.x -= state.speed;
    if(!ob.passed && ob.x + ob.w < dino.x){
      ob.passed = true;
      state.score += 10;
    }
    if(ob.x + ob.w < -50) state.obstacles.splice(i, 1);
  }

  for(const ob of state.obstacles){
    const obRect = { x: ob.x, y: groundY - ob.h, w: ob.w, h: ob.h };
    const dRect = { x: dino.x, y: dino.y, w: dino.w, h: dino.h };
    if(collides(dRect, obRect)){
      gameOver();
      return;
    }
  }

  state.difficultyTimer += dt;
  if(state.difficultyTimer > 1500){
    state.difficultyTimer = 0;
    state.speed += 0.15;
  }

  state.score += dt * 0.02;
  scoreEl.textContent = Math.floor(state.score);

  render();
  requestAnimationFrame(loop);
}

overlay.style.display = 'flex';
msgText.textContent = 'S·∫µn s√†ng?';
msgSub.textContent = 'Nh·∫•n Space / M≈©i l√™n ho·∫∑c ch·∫°m m√†n h√¨nh ƒë·ªÉ b·∫Øt ƒë·∫ßu';
document.getElementById('restart').textContent = 'B·∫ÆT ƒê·∫¶U';

const observer = new ResizeObserver(()=>{ fitCanvas(); });
observer.observe(document.getElementById('game'));
</script>
</body>
</html>
